@model HotelBK.Models.Payment

<div class="payment-details">
    <div class="card mb-3">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Thông tin thanh toán</h5>
        </div>
        <div class="card-body">
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Mã thanh toán:</div>
                <div class="col-md-8">@Model.PaymentID</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Số tiền:</div>
                <div class="col-md-8 text-danger fw-bold">@Model.Amount.ToString("N0") VNĐ</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Phương thức:</div>
                <div class="col-md-8">
                    @switch (Model.PaymentMethod)
                    {
                        case "Cash":
                            <span>Tiền mặt</span>
                            break;
                        case "BankTransfer":
                            <span>Chuyển khoản</span>
                            break;
                        case "CreditCard":
                            <span>Thẻ tín dụng</span>
                            break;
                        case "Momo":
                            <span>Ví MoMo</span>
                            break;
                        case "ZaloPay":
                            <span>ZaloPay</span>
                            break;
                        default:
                            <span>@Model.PaymentMethod</span>
                            break;
                    }
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Ngày thanh toán:</div>
                <div class="col-md-8">@Model.PaymentDate.ToString("dd/MM/yyyy HH:mm:ss")</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Trạng thái:</div>
                <div class="col-md-8">
                    @switch (Model.Status)
                    {
                        case "Completed":
                            <span class="badge bg-success">Hoàn thành</span>
                            break;
                        case "Pending":
                            <span class="badge bg-warning">Đang xử lý</span>
                            break;
                        case "Cancelled":
                            <span class="badge bg-danger">Đã hủy</span>
                            break;
                        default:
                            <span class="badge bg-secondary">@Model.Status</span>
                            break;
                    }
                </div>
            </div>
            @if (!string.IsNullOrEmpty(Model.Notes))
            {
                <div class="row mb-2">
                    <div class="col-md-4 fw-bold">Ghi chú:</div>
                    <div class="col-md-8">@Model.Notes</div>
                </div>
            }
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Thông tin đặt phòng</h5>
        </div>
        <div class="card-body">
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Mã đặt phòng:</div>
                <div class="col-md-8">@Model.Booking.BookingID</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Khách hàng:</div>
                <div class="col-md-8">@Model.Booking.FullName</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Phòng:</div>
                <div class="col-md-8">@Model.Booking.Room.RoomName</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Check-in:</div>
                <div class="col-md-8">@Model.Booking.CheckInDate.ToString("dd/MM/yyyy")</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Check-out:</div>
                <div class="col-md-8">@Model.Booking.CheckOutDate.ToString("dd/MM/yyyy")</div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4 fw-bold">Trạng thái:</div>
                <div class="col-md-8">
                    @switch (Model.Booking.Status)
                    {
                        case "Pending":
                            <span class="badge bg-warning">Chờ xác nhận</span>
                            break;
                        case "Confirmed":
                            <span class="badge bg-info">Đã xác nhận</span>
                            break;
                        case "Checked-in":
                            <span class="badge bg-primary">Đã nhận phòng</span>
                            break;
                        case "Checked-out":
                            <span class="badge bg-success">Đã trả phòng</span>
                            break;
                        case "Cancelled":
                            <span class="badge bg-danger">Đã hủy</span>
                            break;
                        case "Paid":
                            <span class="badge bg-success">Đã thanh toán</span>
                            break;
                        default:
                            <span class="badge bg-secondary">@Model.Booking.Status</span>
                            break;
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center">
        @if (DateTime.Now.Subtract(Model.PaymentDate).TotalDays <= 1)
        {
            <button type="button" class="btn btn-danger deletePayment" data-id="@Model.PaymentID">Xóa thanh toán</button>
        }
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Xử lý nút xóa
        $(".deletePayment").click(function () {
            var id = $(this).data("id");

            if (confirm("Bạn có chắc muốn xóa thanh toán này? Chỉ có thể xóa thanh toán trong vòng 24 giờ.")) {
                $.ajax({
                    url: "/Admin/Payments/Delete/" + id,
                    type: "POST",
                    success: function () {
                        $("#paymentModal").modal("hide");
                        location.reload();
                    },
                    error: function (xhr) {
                        alert(xhr.responseText || "Có lỗi xảy ra khi xóa thanh toán!");
                    }
                });
            }
        });
    });
</script>