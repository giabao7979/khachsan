@model HotelBK.Models.Booking

@{
    ViewData["Title"] = "Đặt phòng";
    var room = ViewBag.Room as HotelBK.Models.Room;
}

<div>
    <!-- Page Header Start -->
    <div class="container-fluid page-header mb-5 p-0" style="background-image: url(img/carousel-1.jpg);">
        <div class="container-fluid page-header-inner py-5">
            <div class="container text-center pb-5">
                <h1 class="display-3 text-white mb-3 animated slideInDown">Đặt phòng</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center text-uppercase">
                        <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                        <li class="breadcrumb-item"><a href="/Room">Phòng</a></li>
                        <li class="breadcrumb-item text-white active" aria-current="page">Đặt phòng</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- Booking Start -->
    <div class="container-xxl py-5">
        <div class="container">
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger mb-4">
                    @TempData["ErrorMessage"]
                </div>
            }

            <div class="row g-5">
                @if (room != null)
                {
                    <div class="col-lg-6">
                        <div class="row g-3">
                            <div class="room-item shadow rounded overflow-hidden">
                                <div class="position-relative">
                                    @if (!string.IsNullOrEmpty(room.Image))
                                    {
                                        <img class="img-fluid" src="@room.Image" alt="@room.RoomName" style="width: 100%; object-fit: cover;">
                                    }
                                    else
                                    {
                                        <img class="img-fluid" src="/img/room-1.jpg" alt="@room.RoomName" style="width: 100%; object-fit: cover;">
                                    }
                                </div>

                                <div class="p-4 mt-2">
                                    <div class="d-flex justify-content-between mb-3">
                                        <h5 class="mb-0">@room.RoomName</h5>
                                        <div class="ps-2">
                                            @for (int i = 0; i < (room.StarRating ?? 0); i++)
                                            {
                                                <small class="fa fa-star text-primary"></small>
                                            }
                                        </div>
                                    </div>
                                    <div class="d-flex mb-3">
                                        <small class="border-end me-3 pe-3"><i class="fa fa-bed text-primary me-2"></i>@room.Beds Giường</small>
                                        <small class="border-end me-3 pe-3"><i class="fa fa-bath text-primary me-2"></i>@room.Bathrooms Phòng tắm</small>
                                        <small><i class="fa fa-wifi text-primary me-2"></i>Wifi</small>
                                    </div>
                                    <p class="text-body mb-3">@(string.IsNullOrEmpty(room.Description) ? "Phòng tiêu chuẩn với đầy đủ tiện nghi." : room.Description)</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-primary fw-bold">@room.Price.ToString("N0") VNĐ/đêm</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <div class="col-lg-6">
                    <div class="wow fadeInUp" data-wow-delay="0.2s">
                        <form method="post" action="/Booking/BookRoom">
                            @if (!ViewData.ModelState.IsValid)
                            {
                                <div class="alert alert-danger">
                                    @Html.ValidationSummary(false, "", new { @class = "text-danger" })
                                </div>
                            }

                            @if (room != null)
                            {
                                <input type="hidden" name="RoomID" value="@room.RoomID" />
                            }
                            else
                            {
                                <div class="row g-3 mb-4">
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <select class="form-select" id="RoomID" name="RoomID" required>
                                                <option value="">-- Chọn phòng --</option>
                                                @foreach (var r in await new HotelBK.Data.HotelContext(null).Rooms.Include(r => r.RoomType).ToListAsync())
                                                {
                                                    <option value="@r.RoomID">@r.RoomName - @r.Price.ToString("N0") VNĐ/đêm</option>
                                                }
                                            </select>
                                            <label for="RoomID">Chọn phòng</label>
                                        </div>
                                    </div>
                                </div>
                            }

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="FullName" name="FullName" placeholder="Họ tên"
                                               value="@(User.Identity.IsAuthenticated ? User.Identity.Name : "")" required>
                                        <label for="FullName">Họ tên</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="email" class="form-control" id="Email" name="Email" placeholder="Email"
                                               value="@(User.Identity.IsAuthenticated ? User.FindFirstValue(ClaimTypes.Email) : "")" required>
                                        <label for="Email">Email</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="Phone" name="Phone" placeholder="Số điện thoại" required>
                                        <label for="Phone">Số điện thoại</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="RoomCount" name="RoomCount" placeholder="Số lượng phòng"
                                               min="1" max="5" value="@(ViewBag.RoomCount ?? 1)" required>
                                        <label for="RoomCount">Số lượng phòng</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="CheckInDate" name="CheckInDate" placeholder="Ngày nhận phòng"
                                               value="@(ViewBag.CheckIn?.ToString("yyyy-MM-dd") ?? DateTime.Now.AddDays(1).ToString("yyyy-MM-dd"))"
                                               min="@DateTime.Now.ToString("yyyy-MM-dd")" required>
                                        <label for="CheckInDate">Ngày nhận phòng</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="CheckOutDate" name="CheckOutDate" placeholder="Ngày trả phòng"
                                               value="@(ViewBag.CheckOut?.ToString("yyyy-MM-dd") ?? DateTime.Now.AddDays(2).ToString("yyyy-MM-dd"))"
                                               min="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" required>
                                        <label for="CheckOutDate">Ngày trả phòng</label>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Để lại ghi chú ở đây" id="SpecialRequest" name="SpecialRequest" style="height: 100px"></textarea>
                                        <label for="SpecialRequest">Yêu cầu đặc biệt</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button class="btn btn-primary w-100 py-3" type="submit">Đặt phòng</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Booking End -->
</div>